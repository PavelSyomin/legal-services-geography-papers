---
output: 
  word_document:
    reference_docx: reference.docx
bibliography: refs.bib
csl: "gost-r-7-0-5-2008-numeric-alphabetical.csl"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  warning = FALSE, 
  message = FALSE, 
  echo = FALSE, 
  fig.width = 6.4, 
  fig.height = 5,
  fig.id = FALSE,
  dpi = 300)
```

```{r imports, include = FALSE, cache = TRUE}
source("Script.R")
```

УДК 911.3, 519.688

<div custom-style="Author">
П. О. Сёмин

P. O. Syomin
</div>

<br>

<div custom-style="Title">
Консольное приложение для создания геопривязанного набора данных о субъектах малого и среднего предпринимательства в России на базе открытых данных Федеральной налоговой службы

A Python CLI application to generate a geo-referenced dataset of small and medium-sized businesses in Russia based on Federal Tax Service open data
</div>

<br>

<br>

<div custom-style="Abstract">
Представлено консольное приложение на языке Python, которое создаёт полный геопривязанный набор данных о субъектах малого и среднего предпринимательства в России. Источник сведений — открытые данные Федеральной налоговой службы. Системные требования — 12 Гб оперативной памяти, 300 Гб свободного места на диске. Создаваемый набор данных содержит: наименование, вид, категорию, ИНН, ОГРН, адрес (населённый пункт, его координаты, ОКТМО), код ОКВЭД, доходы, расходы, среднесписочную численность работников за каждый год c 2016 по 2023.

A command-line Python tool generates a complete geo-referenced dataset of small and medium-sized businesses in Russia. Open data of Federal Tax Service is used as a source. System requirements are 12 Gb of RAM and 300 Gb of free storage. The created dataset includes the following features for each company for each year from 2016 to 2023: name, kind, category, taxpayer number, registration number, address (settlement, geographic coordinates, municipal code), activity code, revenue, expenditure, count of employees.

<br>

Ключевые слова: открытые данные, малое и среднее предпринимательство, ФНС России, набор данных, big data.

Keywords: open data, small and medium-sized businesses, FTS of Russia, dataset, big data.
</div>

В современных экономико-географических исследованиях нередко возникает потребность в дезагрегированных данных. К ним, в частности, относятся сведения о конкретных организациях: наименование, местонахождение, прибыль, число работников, вид деятельности. Такая информация важна при построении математических моделей [@Rostislav2021], для оценки уровня развития территорий [@Gumenyuk2022], при анализе узких сфер деятельности, по которым нет отдельной статистики [@Moiseeva2016; @Pankratov2023], для исследований на локальном уровне (отдельные города, административные районы, муниципальные образования) [@Kozhevnikov2023; @Lachininsky2021]. Для получения дезагрегированных данных исследователи обычно обращаются к системам бизнес-аналитики («Спарк», «Контур.Фокус»), онлайн-картам  (коммерческим, таким как 2ГИС или Яндекс.Карты, или открытым, например, OpenStreetMap) [@Lachininsky2021]. У такого подхода есть существенные недостатки: если данные покупаются, то надо платить, заключать отдельные договоры, соблюдать ограничения, а если данные собираются с общедоступных карт, то их обработка требует существенных усилий и не всегда законна.

В статье представлен инструмент, позволяющий самостоятельно создать набор геопривязанных данных о субъектах малого и среднего предпринимательства (МСП) в России. Получаемый набор содержит такую информацию, как наименование и местонахождение фирмы, её регистрационные номера (ИНН, ОГРН), вид и категорию (физическое или юридическое лицо; микропредприятие, малое или среднее предприятие), код основного вида деятельности по ОКВЭД, доходы, расходы и среднесписочная численность работников за каждый год, начиная с 2019. Местонахождение дано с точностью до населённого пункта (городского или сельского), при этом указаны его географические координаты и код ОКТМО. Сведения доступны с середины 2016 г., что позволяет отслеживать временную динамику. Источник информации — открытые данные Федеральной налоговой службы (ФНС России). Использование открытых данных налоговой службы в экономико-географических исследованиях уже практиковалось рядом специалистов [@Gumenyuk2022; @Rostislav2021; @Lachininsky2021]. Обрабатывать открытые данные ФНС России сложно из-за большого объёма и запутанного формата. Предложенный инструмент упрощает эту задачу.

Приложение использует три набора открытых данных ФНС России: один основной и два вспомогательных. Основной — «Реестр субъектов малого и среднего предпринимательства»[^1], вспомогательные — «Сведения о доходах и расходах организаций»[^2] и «Сведения о среднесписочной численности работников организаций»[^3]. Каждый из них — это коллекция zip-архивов xml-файлов, где один архив содержит данные на определённую дату. Наборы обновляются с разной периодичностью, но не реже раза в год. Каждое обновление — это публикация текущей версии данных полностью, а не только изменений, поэтому сведения в архивах частично дублируются.

[^1]: https://www.nalog.gov.ru/opendata/7707329152-rsmp/
[^2]: https://www.nalog.gov.ru/opendata/7707329152-revexp/
[^3]: https://www.nalog.gov.ru/opendata/7707329152-sshr2019/

Для геопривязки приложение использует две справочные таблицы населённых пунктов России: набор «Населённые пункты России»[^4] от проекта «Инфраструктура научно-исследовательских данных» и набор «Города России»[^5], бесплатно опубликованный коммерческой компанией DaData.

[^4]: https://data.rcsi.science/data-catalog/datasets/160/
[^5]: https://github.com/hflabs/city

Приложение представляет собой консольную программу на языке программирования Python. Оно основано на нескольких популярных сторонних компонентах: Pandas (средство обработки табличных данных), lxml (библиотека для чтения xml-файлов), Apache Spark (инструмент для обработки больших объёмов данных), Typer (фреймворк для создания интерфейсов командной строки). Приложение работает на компьютере средней конфигурации: достаточно 12 Гб оперативной памяти и 300 Гб свободного места на жёстком диске.

Алгоритм обработки данных состоит из пяти шагов: загрузка данных, извлечение данных из архивов (с опциональной фильтрацией по виду деятельности), агрегирование данных для удаления повторяющихся записей, геопривязка, создание панельного представления (по годам). Соответственно, приложение включает в себя пять ключевых компонентов: загрузчик (Downloader), распаковщик (Extractor), агрегатор (Aggregator), геопривязчик (Georeferencer), генератор панельного представления (Panelizer). Командный интерфейс, в свою очередь, содержит пять основных команд: download, extract, aggregate, georeference, panelize. У каждой команды есть опции, описание которых имеется в документации. Поскольку предполагается, что основной сценарий использования приложения — это создание набора данных «под ключ», то интерфейс включает комбинированную команду process, которая берёт исходные данные, по очереди запускает все этапы обработки и производит панельный набор данных.

Приложение размещено в открытом репозитории по адресу: https://github.com/PavelSyomin/russian-smb-companies. Там же доступна документация с примерами использования.

Для проверки и демонстрации работы приложения был подготовлен набор данных о фирмах, ведущих деятельность в сфере сельского, лесного хозяйства, охоты, рыболовства и рыбоводства (группа «А» ОКВЭД). Объём исходных данных — чуть больше 200 Гб в сжатом виде и около 2.5 Тб в несжатом, размер итогового панельного представления — 630 Мб, то есть в сотни раз меньше. Время обработки — около 15 часов. Набор данных содержит сведения о `r total` фирмах.

Картограмма (рис. 1) показывает все организации в сфере сельского хозяйства в 2021 г., сведения о которых имеются в наборе данных. Таблица 1 — это пример одной записи из набора данных, который позволяет понять состав сведений.

```{r plot-1, fig.cap = "Рис. 1. Населённые пункты регистрации российских малых и средних организаций, ведущих деятельность в сфере сельского хозяйства (растениеводства и животноводства), в 2021 г. Если в одном и том же населённом пункте находится несколько организаций разной отрасли, то цвет показывает, каких организаций в этом месте больше"}
plot_1
```

```{r sample-table}
knitr::kable(
  sample_table, 
  col.names = c("Признак", "Значение"),
  caption = "Таблица 1. Пример одной записи из набора данных, созданного с помощью приложения"
  )
```

Таким образом, приложение помогает исследователю собрать и подготовить исходные данные для дальнейшего анализа. Оно может использоваться как частичная альтернатива коммерческим сервисам, предоставляющим дезагрегированные данные об организациях. Получаемый набор данных подходит для изучения малого и среднего предпринимательства как такового, а также анализа тех отраслей экономики и видов экономической деятельности, где малые и средние предприятия преобладают.

# Использованная литература

<div id="refs"></div>

# Сведения об авторе

**Сёмин Павел Олегович** — аспирант Пермского государственного национального исследовательского университета, бэкенд-разработчик ООО «АгроСофтвер», ntsp\@ya.ru.

**Pavel O. Syomin** (ntsp\@ya.ru) is a PhD student at Perm State University and a backend developer at AgroSoftware LLC.
