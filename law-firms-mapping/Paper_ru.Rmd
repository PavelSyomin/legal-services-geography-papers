---
output:
  odt_document:
    reference_odt: assets/reference.odt
bibliography: assets/biblio_ru.bib
csl: assets/gost-r-7-0-100-2018-numeric-alphabetical.csl
link-bibliography: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.width = 5.7,
  fig.height = 3,
  fig.id = FALSE,
  dpi = 300)
```

```{r imports, cache = TRUE, include = FALSE}
RU <- TRUE
source("helpers/Plots.R")
```

УДК 911.3, 519.688

<div custom-style="Author">

**П. О. Сёмин**

Пермский государственный национальный исследовательский университет, Пермь, Россия

E-mail: ntsp\@ya.ru

</div>

<br>

<div custom-style="Title">

Картографирование российских субъектов малого и среднего предпринимательства по открытым данным налоговой службы

</div>

<br>

*В статье представлена гибкая и воспроизводимая методика картографирования субъектов малого и среднего предпринимательства (МСП) в России. В настоящий момент не хватает качественных наборов данных для визуализации характеристик экономики страны на карте. Существующие официальные источники содержат информацию о местоположении тех или иных объектов в виде человекочитаемых адресов, в то время как ГИС-платформы требуют машиночитаемые пространственные данные с координатами. Представленный в работе набор инструментов — это попытка решить проблему и упростить подготовку данных для картографирования. В качестве источника сведений используются три набора открытых данных Федеральной налоговой службы, в частности, выгрузки реестра МСП. Для их обработки, нормализации адресов и геокодирования было разработано специальное приложение командной строки на языке программирования Python. Несмотря на большой объём исходных данных, приложение работает на среднем современном компьютере и не требует обращения к облачным вычислительным мощностям. Работоспособность инструментов продемонстрирована путём картографирования небольшой части исходного набора данных — сведений о юридических фирмах.*

***Ключевые слова:*** *открытые данные, пространственные данные, картографирование, геокодирование, малое и среднее предпринимательство, набор данных, большие данные, Федеральная налоговая служба.*

<br>

<div custom-style="Author">

**P. O. Syomin**

Perm State University, Perm, Russia

E-mail: ntsp\@ya.ru

</div>

<br>

<div custom-style="Title">

Mapping Russian Small and Medium-Sized Businesses Using Tax Service Open Data

</div>

<br>

*This paper presents a flexible and reproducible workflow for creating highly detailed maps of small and medium-sized businesses (SMBs) in Russia. Currently, there is a lack of data sources for mapping the Russian economy, and existing official datasets often provide location information in human-readable addresses rather than machine-readable geographical coordinates. The proposed set of tools aims to solve this problem and simplify the mapping process. The study utilizes three open datasets published by the Federal Tax Service, including open dumps of SMB registry, as its data source. To transform the source data into tables and normalize and geocode the addresses, a Python CLI application was developed. Despite the large volume of the initial data archives, the application can run on a regular modern personal computer without the need for cloud computing resources. The workflow's usability is demonstrated by mapping a small subset of data, specifically law firms in Russia.*

***Keywords:*** *open data, spatial data, mapping, geocoding, small and medium-sized business, dataset, big data, Federal Tax Service.*

<br>


**Введение.** Современные картографические инструменты, используемые в науке и практике, обычно предполагают использование источников хорошо структурированных пространственных данных. Под «пространственными» в данном случае понимаются такие данные, которые представлены в одном из распространённых и широко используемых форматов и содержат географические координаты объектов в одной из стандартных систем координат (например, WGS84). Получение таких наборов данных может быть трудной задачей, которая существенно замедлит процесс исследования или увеличит его стоимость. Запрос со стороны академического сообщества и бизнес-кругов на качественные пространственные данные настолько важен, что понемногу стимулирует правительства разных стран создавать геопорталы или упрощать распространение геоданных иными способами [@Jozefowicz2020].

В России официальная информация время от времени публикуется в машиночитаемом виде с координатами, но как правило, открытые геоданные доступны весьма плохо. Относительно слабая доступность таких данных может создавать проблемы при картографировании различных общественных процессов: экономических, географических, культурных. Даже если набор государственных данных содержит географическую привязку в виде «обычного», человекочитаемого адреса, его не получится использовать напрямую для создания карты, так как ГИС-приложениям необходимы машиночитаемые координаты. Для преобразования адресов в координаты служит процедура, известная как геокодирование (geocoding). Для российских адресов обычно используется несколько популярных геокодеров: Geocoding API от Яндекса или Google, сервис геокодирования компании DaData, инструмент OpenStreetMap Nominatim. Они обеспечивают сравнительно хорошее качество, но обычно предоставляются за плату, а в бесплатном варианте сложны в настройке или запрещают сохранять получаемые данные для последующего использования. Соответственно, актуален вопрос об удобном инструменте, который позволил бы облегчить картографирование ценных наборов открытых государственных данных.

Одним из наборов открытых государственных данных в России, который потенциально имеет высокую ценность для исследователей в сфере экономической географии, может являться реестр субъектов малого и среднего предпринимательства (МСП). Указанный реестр ведётся с конца 2015 года на основании ст. 4.1 Федерального закона от 24.07.2007 №209-ФЗ «О развитии малого и среднего предпринимательства в Российской Федерации». Оператор реестра — Федеральная налоговая служба (ФНС России). Реестр автоматически включает в себя сведения обо всех коммерческих юридических лицах и индивидуальных предпринимателях, которые соответствуют установленным критериям. Основных критериев два: среднесписочная численность работников не превышает 250 человек, а доход за год — 2 миллиардов рублей.

Реестр МСП представляет собой наиболее полный общедоступный источник дезагрегированных сведений о российских коммерческих организациях. Другие варианты, такие как системы бизнес-аналитики (например, Спарк-Интерфакс или Контур.Фокус) или веб-портал Единого государственного реестра юридических лиц, доступны за плату или ограничивают бесплатное использование, что уменьшает их полезность. Данные официальной статистики бесплатны, но предоставляются в сводном (агрегированном) виде, то есть без детализации до уровня отдельных фирм. Напротив, полные выгрузки реестра МСП ежемесячно размещаются в разделе открытых данных ФНС России, доступны бесплатно и детализированы до конкретных организаций и предпринимателей. Проблема в том, что координат в них нет — только адреса. Кроме того, выгрузки имеют большой объём (суммарно несколько сотен гигабайт в сжатом виде и более двух терабайт в несжатом) и сложную структуру.

**Цель статьи.** Данная работа направлена на то, чтобы представить гибкую и воспроизводимую методику картографирования российских малых и средних фирм на основе открытых данных ФНС России. Воспроизводимость достигается за счёт разработки и публикации открытого приложения для обработки и геокодирования данных налоговой службы, которое может быть использовано исследователями для своих задач. В статье приводится пример картографирования российских юридических фирм на основе описанной методики. Аналогичный подход может использоваться для картографирования юридических лиц и индивидуальных предпринимателей в любой сфере деятельности.

**Обзор литературы.** Типичным источником данных для исследований по экономической географии России являются ресурсы Федеральной службы государственной статистики (Росстат) [@Sarancha2014; @Kuznetsova2018; @Petrov2021; @Safronov2021; @Fedorov2022]. К ним относятся официальная статистика, переписи населения и статистические обследования, доступные на официальном сайте этого государственного органа, а также база данных показателей муниципальных образований (БДМО) и единая межведомственная информационно-статистическая система (ЕМИСС). Росстат является важнейшим провайдером информации для исследований в области экономической географии, и его данные явно или неявно используются почти во всех научных работах. Эти данные не пригодны для картографирования напрямую из-за отсутствия координат. Тем не менее, они содержат информацию о местоположении с точностью до регионов, муниципалитетов и городов, которую для создания карты можно объединить с пространственными данными из других источников, таких как GADM или Natural Earth.

Экономико-географы используют административные данные ФНС России в качестве альтернативного источника информации. Эти данные публикуется на официальном сайте указанного органа власти или связанных с ним веб-ресурсах. В исследованиях применяются, в частности, сведения о доходах физических лиц [@Petrov2021], о налоговых поступлениях по регионам или видам экономической деятельности [@Rostislav2020; @Safronov2021], о среднесписочной численности работников организаций [@Rostislav2021], о числе субъектов малого и среднего предпринимательства и мерах их поддержки [@Gumenyuk2022]. ФНС России не является специализированным статистическим органом, но собирает огромный объем информации о различных аспектах российской экономики, в том числе о хозяйствующих субъектах, имуществе, доходах и расходах. Географическое положение в данных ФНС, как и у Росстата, описывается с помощью адресных элементов. Стоит отметить, что ФНС России поддерживает Федеральную информационную адресную систему (ФИАС), предоставляющую официальные открытые адресные данные по России, которые широко используются другими государственными органами, а также бизнесом.

В современных исследованиях географы часто оперируют информацией, детализированной до уровня отдельных фирм. Эти дезагрегированные данные можно использовать напрямую [@Rostislav2021; @Kolomak2023] или для расчета производных показателей, которых нет в статистике Росстата [@Sarancha2014; @Gumenyuk2022; @Makushin2023]. В исследованиях на уровне городов [@Lachininsky2021; @Nikonorov2021; @Kozhevnikov2023] информация о конкретных фирмах имеет особую важность. Такая же детализированность крайне ценна при анализе узких секторов экономики, которые отдельно не представлены в агрегированной статистике [@Moiseeva2016; @Pankratov2023]. Для получения подобных данных исследователи обычно используют коммерческие или открытые геоинформационные сервисы, а также системы бизнес-аналитики [@Lachininsky2021; @Moiseeva2016; @Kuzminov2021]. Однако эти источники характеризуются двумя недостатками: они либо платные, либо сложны для использования. Так, системы бизнес-аналитики, такие как Спарк или Контур.Фокус, являются коммерческими, хотя и содержат огромный набор сведений о различных аспектах деятельности компаний. Общедоступные картографические сервисы наподобие 2ГИС и Яндекс.Карт позволяют выгружать данные только за плату, а автоматизированный сбор сведений, доступных бесплатно (так называемый парсинг, или скрейпинг), запрещён их пользовательскими соглашениями. Открытые платформы, такие как OpenStreetMap, бесплатны, но выгрузки (дампы) их данных имеют большой объём и сложную структуру — преобразование в удобный формат требует много времени и сил.

**Данные.** Картографирование по методике, предложенной в этой статье, предполагает использование одного основного источника данных вместе с двумя дополнительными, а также двух справочных таблиц.

Основным источником данных являются выгрузки (дампы) реестра МСП[^1], которые публикуются каждый месяц, начиная с августа 2016 года. Каждая выгрузка содержит полную информацию реестра на дату публикации, что приводит к существенному дублированию. Технически выгрузка представляет собой ZIP-архив, содержащий тысячи XML-файлов, каждый из которых содержит информацию о 900 юридических лицах или индивидуальных предпринимателях. Атрибуты XML-файла включают, в частности, номер налогоплательщика (ИНН), наименование юридического лица или имя физического лица, адрес регистрации (область, район, город, населённый пункт), а также коды видов деятельности (основного и дополнительных) по Общероссийскому классификатору видов экономической деятельности (ОКВЭД) в редакции 2014 года.

[^1]: Единый реестр субъектов малого и среднего предпринимательства [Электронный ресурс]. URL: https://www.nalog.gov.ru/opendata/7707329152-rsmp/ (дата обращения: 29.02.2024)

Дополнительными источниками информации выступают два других набора открытых данных ФНС России. Первый из них называется «Сведения о суммах доходов и расходов по данным бухгалтерской (финансовой) отчетности организации»[^2], а второй — «Сведения о среднесписочной численности работников организации»[^3]. Оба доступны приблизительно с 2019 года и обновляются не реже одного раза в год, хотя обновления могут быть нерегулярными. Технически эти наборы данных тоже представляют собой коллекции ZIP-архивов, содержащих файлы XML. Каждый архив содержит данные за определенную дату, а в каждом XML-файле представлены сведения для 900 юридических лиц. Информация об индивидуальных предпринимателях не включена в эти наборы из-за необходимости защиты персональных данных.

[^2]: Сведения о суммах доходов и расходов по данным бухгалтерской (финансовой) отчетности организации [Электронный ресурс]. URL: https://www.nalog.gov.ru/opendata/7707329152-revexp/ (дата обращения: 29.02.2024)
[^3]: Сведения о среднесписочной численности работников организации [Электронный ресурс]. URL: https://www.nalog.gov.ru/opendata/7707329152-sshr2019/ (дата обращения: 29.02.2024)

Справочными таблицами, используемыми для картографирования, являются набор данных «Населенные пункты России: число жителей и географические координаты», предоставленный проектом «Инфраструктура научно-исследовательских данных»[^4] и набор данных «Города России», опубликованный коммерческой компанией HFLabs[^5]. Оба содержат адреса и географические координаты российских городов и населенных пунктов. Поскольку информация о некоторых городах в них отсутствовала, автор статьи добавил её вручную на основе сведений Федеральной информационной адресной системы[^6].

[^4]: Населенные пункты России: численность населения и географические координаты [Электронный ресурс]. URL: (дата обращения: 29.02.2024) https://data.rcsi.science/data-catalog/datasets/160/
[^5]: Города России [Электронный ресурс]. URL: https://github.com/hflabs/city (дата обращения: 29.02.2024)
[^6]: Федеральная информационная адресная система [Электронный ресурс]. URL: https://fias.ru (дата обращения: 29.02.2024)

Для обработки исходных данных было разработано приложение командной строки (CLI) на языке программирования Python. Технически оно основано на стандартной библиотеке этого языка и нескольких сторонних компонентах, включая быструю библиотеку обработки XML *lxml*, широко известное средство для работы с табличными данными *Pandas*, популярную платформу больших данных *Apache Spark* и простой в использовании фреймворк консольных приложений *Typer*. Исходный код приложения с краткой документацией размещён в общедоступном репозитории на платформе GitHub[^8]. Далее в статье описывается принципиальный (то есть без погружения в детали) алгоритм обработки данных, реализованный в приложении. «Входом» этого алгоритма являются исходные наборы данных ФНС России (справочные таблицы де-факто являются частью приложения). На «выходе» получаются таблицы с геокодированными сведениями, пригодные для использования в любом ГИС-приложении, поддерживающем CSV-файлы в качестве формата данных для векторных слоёв.

[^8]: PavelSyomin/russian-smb-companies: Dataset on small and medium business companies registered in Russia based on Federal Tax Service open data [Электронный ресурс]. URL: https://github.com/PavelSyomin/russian-smb-companies (дата обращения: 29.02.2024)

*Шаг 1* — загрузка данных. Исходные ZIP-архивы загружаются с сайта ФНС России и сохраняются локально.

*Шаг 2* — извлечение и фильтрация данных. Данные реестра МСП извлекаются из ZIP-архивов и сохраняются в таблицах в формате CSV, так что один ZIP-архив преобразуется в одну CSV-таблицу. Многие неиспользуемые атрибуты отбрасываются, поэтому размер CSV-таблиц получается намного меньше размера исходных архивов. Кроме того, на этом этапе опционально осуществляется фильтрация по коду основного вида деятельности: это ускоряет процесс и дополнительно уменьшает объём CSV-таблиц. Например, для подготовки демонстрационного примера о юридических фирмах был выбран код основного вида деятельности 69.10 (деятельность в области права по ОКВЭД). Аналогичным образом преобразуются два вспомогательных набора данных, только без фильтрации по ОКВЭД, потому что кодов вида деятельности в них нет.

*Шаг 3* — агрегация данных: она позволяет удалить дублирующиеся записи и собрать сведения из множества CSV-таблиц в одну. Дублирование происходит из-за того, что каждая выгрузка реестра МСП — это сведения реестра целиком, а не только лишь обновления ранее размещённой информации. Кроме того, в ходе агрегирования вспомогательные наборы данных фильтруются так, чтобы в них остались сведения только о тех фирмах, которые были отобраны по коду ОКВЭД на шаге 2. В качестве уникального идентификатора компании при этом используется ИНН.

*Шаг 4* — геокодирование. Адрес нормализуются и преобразуются в географические координаты с использованием справочных таблиц. Полнота геокодирования — около 98%. Поскольку в исходных данных адрес детализирован до городов или населенных пунктов, географические координаты также относятся к городам или населенным пунктам.

Опциональный *шаг 5* — объединение и трансформация результатов, полученных на шагах 3–4, в панельную таблицу. В панельной таблице сведения о каждой фирме за каждый год представлены одной строкой. Таблицы, которые производятся на шагах 3 и 4, построены по-другому: в них для каждой строки указаны даты актуальности сведений, что позволяет добиться большей компактности, но менее удобно для анализа.

Для подготовки демонстрационного примера набор табличных данных, полученный с помощью приложения, был отфильтрован по году (выбран 2021-й). Карты создавались с помощью скрипта, написанного на языке программирования R, с дополнительными пакетами, включая, в частности, ggplot2 и sf. Исходный код статьи доступен в отдельном репозитории[^9].

[^9]: ru-smb-companies-papers/legal-companies-mapping at main · PavelSyomin/ru-smb-companies-papers [Электронный ресурс]. URL: https://github.com/PavelSyomin/ru-smb-companies-papers/tree/main/legal-companies-mapping (дата обращения: 29.02.2024)

**Результаты.** Хотя данные детализированы до конкретных фирм, они также содержат информацию о местонахождении с указанием как региона (субъекта федерации), так и населённого пункта, поэтому их можно агрегировать. На рис. 1 показано количество юридических фирм по регионам. Из этой визуализации видны некоторые пространственные закономерности, например: с одной стороны, концентрация юридических фирм в Москве и Московской области, а также в поясе, протянувшемся от Урала через Поволжье к Краснодару, а с другой стороны, сравнительно небольшое их число, например, в субъектах, образующих Центральный экономический район, что может быть связано с близостью столицы, оттягивающей на себя большинство компаний.

```{r fig-1-regions-map, fig.cap = "**Рис. 1.** Число юридических фирм по регионам (субъектам федерации) в России в 2021 году"}
regions_map
```

На рис. 2 представлена карта числа юридических фирм по городам и сельским населенным пунктам. По сути это выполненный с довольно высокой детализацией (до населённых пунктов) обзор юридического бизнеса в России. Карта похожа на региональную (см. рис. 1), однако данные на уровне городов позволяют заметить и другие тенденции, например, концентрацию бизнеса в региональных центрах. Кроме того, очевидно высокое сосредоточение в Москве и ее окрестностях. Аналогичная картина просматривается в Санкт-Петербурге. Подобную карту можно построить не только для страны в целом, но и для отдельного региона (Свердловская область на рис. 3).

```{r fig-2-settlements-map, fig.cap = "**Рис. 2.** Число юридических фирм в городских и сельских населённых пунктах России в 2021 году"}
settlements_map
```

<br>

```{r fig-3-settlements-map-svr, fig.cap = "**Рис. 3.** Число юридических фирм в городских и сельских населённых пунктах Свердловской области в 2021 году"}
settlements_map_svr
```

Наличие дополнительных данных о финансовых результатах и числе сотрудников позволяет построить дополнительные карты. На рис. 4 показано пространственное распределение прибыли юридических компаний, а на рис. 5 — аналогичное распределение по численности сотрудников. Обе карты включают только компании с ненулевой прибылью или количеством сотрудников. Карты похожи на ту, что изображена на рис. 2, но отличаются в деталях.

```{r fig-4-profit-map, fig.cap = "**Рис. 4.** Суммарная прибыль юридических фирм по городам и сельским населённым пунктам в России в 2021 году"}
settlements_map_profit
```

<br>

```{r fig-5-employees-map, fig.cap = "**Рис. 5.** Суммарное число работников юридических фирм по городам и сельским населённым пунктам в России в 2021 году"}
settlements_map_empl
```

**Заключение.** В данной статье предлагается гибкое решение для картографирования субъектов малого и среднего предпринимательства в России. Оно основано на использовании открытых данных, публикуемых Федеральной налоговой службой, которые предварительно обрабатываются и геокодируются с помощью специально разработанного приложения с открытым исходным кодом на языке программирования Python. В качестве примера приведены карты юридических фирм и их бизнес-показателей (прибыль и количество сотрудников), подтверждающие работоспособность предлагаемого метода. Код приложения, используемого для подготовки набора данных, и код скриптов, используемых для создания карт, опубликованы в общедоступных репозиториях на GitHub. Несмотря на большой объем исходных данных (до нескольких терабайт в распакованном виде), инструменты оптимизированы для работы на обычном современном компьютере средней конфигурации и не требуют приобретения облачных вычислительных ресурсов. Кроме того, геокодирование выполняется с помощью простых справочных таблиц вместо коммерческих API, поэтому весь процесс осуществляется бесплатно и в автономном режиме.

Описанный подход имеет ряд недостатков и ограничений. Прежде всего, несмотря на то, что инструменты сделаны максимально простыми, они все равно требуют некоторых базовых знаний в области программирования, поскольку исследователь должен запустить приложение на Python и, следовательно, должен уметь устанавливать Python и работать с командной строкой. Далее, генерация набора данных, несмотря на усилия по оптимизации, по-прежнему занимает значительное время (до одного-двух дней, если не используется фильтрация). В-третьих, точность геокодирования хотя и высока, но не равна 100%. Наконец, исходные данные ограничены только субъектами малого и среднего предпринимательства, поэтому любые выводы, основанные на них, следует делать с осторожностью. Тем не менее, предложенный метод позволяет осуществить наиболее полное картографирование российского бизнеса, основанное на открытых данных и алгоритмах. Это может быть особенно полезно для разведочного анализа, для изучения малого и среднего предпринимательства как такового и для анализа узких секторов экономики, которые не попадают в обычную статистическую отчетность.

# Список литературы

<div id="refs"></div>

<br>

# Сведения об авторе

Сёмин Павел Олегович, аспирант кафедры социально-экономической географии Пермского государственного национального исследовательского университета, г. Пермь, Россия; разработчик в ООО «АгроСофтвер», г. Москва, Россия.

E-mail: ntsp\@ya.ru

ORCID: 0000-0002-4015-9206

# About the author

Pavel Olegovich Syomin, PhD Student, Department of Social and Economic Geography, Perm State University, Perm, Russia; Software Developer, AgroSoftware LLC, Moscow, Russia.

E-mail: ntsp\@ya.ru

ORCID: 0000-0002-4015-9206


