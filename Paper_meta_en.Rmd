---
output:
  odt_document:
    number_sections: true
    reference_odt: assets/reference.odt
bibliography: assets/biblio_en.bib
csl: "assets/citations.csl"
link-bibliography: false
nocite: "@*"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  warning = FALSE, 
  message = FALSE, 
  echo = FALSE, 
  fig.width = 6.5, 
  fig.height = 5,
  fig.id = FALSE,
  dpi = 300)
options(knitr.kable.NA = "—")
LOCALE = "en"
```

```{r imports, cache = TRUE, include = FALSE}
source("Plots.R")
source("StatsHelper.R")
source("Diagram.R")
```

UDC 911.3, 519.688

<br>

**Technology of Making a Geo-Referenced Dataset about Small and Medium-Sized Businesses in Russia Based on the Federal Tax Service's Open Data**

<br>

Pavel O. Syomin

<br>

Perm State University, 15 Bukireva st., Perm, 614068, Russian Federation

<br>

Pavel O. Syomin: ntsp\@ya.ru, ORCID 0000-0002-4015-9206

<br>

Contact:  

Pavel O. Syomin 

Phone +7 9222 06 77 01  

Email: ntsp\@ya.ru  

Address: 35-62 Kosmonavtov st., Sverdlovsk obl., Nizhniy Tagil, 622002, Russia

# Abstract {-}

The paper features a technology for creating a geo-referenced tabular dataset of small and medium-sized businesses (SMBs) in Russia based on open data from the Federal Tax Service (FTS of Russia). The resulting dataset covers the entire territory of Russia for 2016—2023. It is a complete list of SMBs and it contains information on registration numbers, category, name, address, activity type, income, expenses, and number of employees. In spatial terms, the dataset is detailed down to settlements, including geographic coordinates and municipal code (OKTMO); in a temporary sense — up to months or years, depending on the specific feature; in relation to the type of activity — up to individual codes of the activity classifier. Unlike a classic data paper, the article does not describe the resulting dataset as such, but outlines a reproducible methodology for creating it and demonstrates its use to obtain a dataset of firms in the agriculture, forestry and fisheries sectors. Using the proposed algorithm and its implementation in Python, the researcher can independently process the source data and get an up-to-date version of the dataset, tailored to his purposes. The algorithm is optimized so that it runs on a typical PC despite the relatively large (~2Tb uncompressed) volume of source data. The dataset produced by the proposed method can be used for spatial analysis of SMBs in Russia and as an open, free and relatively representative source of information about the Russian economy in the context of specific organizations, making it possible to partially replace commercial business intelligence systems like Spark and Kontur.Focus. In addition, thanks to the coordinates, the data set can be used for mapping without additional processing, and the presence of OKTMO codes allows it to be combined with official statistical information.

**Keywords:** open data, spatial analysis, spatial data, administrative data, small&medium business, business registry, dataset, big data, Apache Spark, FTS of Russia

# Bibliography {-}

<div id="refs"></div>


\newpage

```{r fig-1-diagram, fig.cap = "Fig. 1. Data Processing Diagram"}
grid::grid.raster(diagram_raster)
```

<br>

```{r tab-1-sizes-funnel}
bytes_in_mb <- 2 ** 20
sizes_funnel <-  sizes_funnel / bytes_in_mb
knitr::kable(
  sizes_funnel,
  digits = 0,
  format.args = list(scientific = FALSE),
  col.names = c("SMB Registry", "Revenue+Expenditure", "Employees", "Total"),
  caption = "Table 1. Change in the data volume during program execution (in megabytes). Rows are stages, columns are source datasets and totals")
```

<br>

```{r tab-2-counts-funnel}
counts_funnel <- counts_funnel / 1000 # in thousands
knitr::kable(
  counts_funnel,
  digits = 0,
  format.args = list(scientific = FALSE),
  col.names = c("SMB Registry", "Revenue+Expenditure", "Employees"),
  caption = "Table 2. Change in the number of records during program execution (in thousands). Rows are stages, columns are source datasets")
```

<br>

```{r fig-2-time-series-plot, fig.cap = "Fig. 2. Monthly changes in the number of SMBs in the demo dataset in 2016–2023. Only top 15 regions are shown"}
time_series_plot
```

<br>

```{r fig-3-regions-agri-forest, fig.cap = "Fig. 3. Regional distribution of SMBs which main activity is agriculture or forestry, in 2021. Color represents the min-max scaled value"}
regions_plot_agri_forestry
```

<br>

```{r fig-3-regions-wheat-potato, fig.cap = "Fig. 4. Regional distribution of SMBs which main activity is growing of wheat or potato, in 2021. Color represents the min-max scaled value, gray is no data"}
regions_plot_wheat_potato
```

<br>

```{r fig-5-activity-by-settlements-russia, fig.cap = "Fig. 5. Count of SMBs in some Russian settlements with dominant activity type, in 2021. The counts are represented by circle size, and the most popular activity group in the settlement is displayed by color. Only settlements with 50+ SMBs are shown"}
activity_by_settlements
```

<br>

```{r fig-6-activity-by-settlements_svr, fig.cap = "Fig. 6. Count of SMBs in settlements of Sverdlovsk region with dominant activity type, in 2021. The counts are represented by circle size, and the most popular activity group in the settlement is displayed by color. All settlements regardless of the counts are shown"}
activity_by_settlements_svr
```

<br>

```{r fig-7-migrations, fig.cap = "Fig. 7. Regional distribution of SMBs which have arrived to or left the region during 2016–2023"}
migrations_plot
```

<br>

```{r fig-8-count-employees-profit-by-region, fig.cap = "Fig. 8. Regional distribution of counts of SMBs, their total profit and total number of employees in the demo dataset in 2021"}
count_profit_employees_by_region_plot
```

<br>

```{r tab-3-corr-by-year}
knitr::kable(
  corr_by_year,
  digits = 2, 
  col.names = c("Year", "$\\rho_{Spearman}$, all activity groups", "$\\rho_{Spearman}$, excluding groups O, P, U"),
  caption = "Table 3. The correlation between the count of SMB organizations and total count of commercial organizations by year")
```

<br>

```{r fig-9-corr-by-region, fig.cap = "Fig. 9. Distribution of regions by the correlation coefficient between the SMB organizations counts and total commercial organizations counts"}
corr_by_region_plot
```

<br>

```{r tab-4-corr_by_group}
knitr::kable(
  corr_by_group,
  digits = 2,
  col.names = c("Activity group", "$\\rho_{Spearman}$"),
  caption = "Table 4. The correlation between the count of SMB organizations and total count of commercial organizations by activity group")
```
